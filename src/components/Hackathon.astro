---
import { fade } from "astro:transitions";
import CTA from "./CTA.astro";
import TerminalBlock from "./TerminalBlock.astro";
const { hackathon, event } = Astro.props;

const summaryItems = hackathon?.summary
  ? [
      hackathon.summary.modality,
      hackathon.summary.organizers,
      hackathon.summary.collaborators,
      hackathon.summary.objective,
      hackathon.summary.theme,
    ].filter(Boolean)
  : [];

const criteria = hackathon?.evaluation?.criteria ?? [];
const officialTools = Array.isArray(hackathon?.tools?.items)
  ? hackathon.tools.items
  : [];
---

<div transition:animate={fade()} class="w-full max-w-2xl mx-auto">
  <div class="bg-surface">
    <div class="p-6 md:p-10">
      <header class="text-center mb-6">
        <h1 class="text-3xl md:text-4xl font-bold text-primary">
          {hackathon?.title}
        </h1>
        {
          hackathon?.subtitle ? (
            <p class="text-accent font-semibold mt-2">{hackathon.subtitle}</p>
          ) : null
        }
      </header>

      <section class="prose text-primary mb-6 space-y-4">
        <p>{hackathon?.description}</p>

        <CTA cta={event.ctas?.hackathon ?? event.cta} />
        {
          summaryItems.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Información general
              </h3>
              <ul class="list-disc list-inside space-y-1">
                {summaryItems.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.participants?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Participantes</h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.participants.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.timeline?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Desarrollo del evento
              </h3>
              <ul class="list-disc list-inside space-y-2">
                {hackathon.timeline.map((stage: any) => (
                  <li>
                    <span class="font-semibold text-primary">
                      {stage.title}:
                    </span>{" "}
                    {stage.description}
                  </li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.deliverables?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Entregables finales
              </h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.deliverables.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.tools ? (
            <div>
                <h3 class="text-accent font-semibold mb-2">Herramientas oficiales</h3>
                {hackathon.tools.intro ? (
                  <p class="mb-3">{hackathon.tools.intro}</p>
                ) : null}
                {officialTools.length ? (
                  <div class="space-y-3">
                    {officialTools.map((tool: any) => (
                      <div class="flex items-start gap-4 p-4 rounded-lg border border-dashed border-accent/40 bg-surface/60">
                        {tool.image ? (
                          <img src={tool.image} alt={tool.name} class="w-16 h-16 object-contain" loading="lazy" />
                        ) : null}
                        <div>
                          <p class="font-semibold text-primary text-lg">
                            {tool.link ? (
                              <a href={tool.link} target="_blank" rel="noopener noreferrer" class="command-link">
                                &gt; {tool.name}
                              </a>
                            ) : (
                              tool.name
                            )}
                          </p>
                          {tool.description ? (
                            <p class="text-sm text-muted mt-1">{tool.description}</p>
                          ) : null}
                        </div>
                      </div>
                    ))}
                  </div>
                ) : null}
            </div>
          ) : null
        }

        {
          hackathon?.rules?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Reglas generales</h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.rules.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.evaluation ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Evaluación</h3>
              {hackathon.evaluation.notes ? (
                <p class="mb-2">{hackathon.evaluation.notes}</p>
              ) : null}
              {criteria.length ? (
                <ul class="list-disc list-inside space-y-1">
                  {criteria.map((item: any) => (
                    <li>
                      <span class="font-semibold">{item.name}</span> (
                      {item.weight}) – {item.description}
                    </li>
                  ))}
                </ul>
              ) : null}
            </div>
          ) : null
        }

        {
          hackathon?.awards?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Premios y reconocimientos
              </h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.awards.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.challenges?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Retos del hackathon
              </h3>
              <ul class="list-disc list-inside space-y-2">
                {hackathon.challenges.map((item: any) => (
                  <li>
                    <span class="font-semibold text-primary">
                      {item.title}:
                    </span>{" "}
                    {item.description}
                  </li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.guidelines?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">
                Normas y consideraciones
              </h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.guidelines.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.officialSite ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Sitio oficial</h3>
              <a
                href={hackathon.officialSite}
                target="_blank"
                rel="noopener noreferrer"
                class="command-link"
              >
                &gt; Abrir sitio oficial
              </a>
            </div>
          ) : null
        }

        {
          hackathon?.committee?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Comité organizador</h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.committee.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }

        {
          hackathon?.location?.length ? (
            <div>
              <h3 class="text-accent font-semibold mb-2">Ubicación</h3>
              <ul class="list-disc list-inside space-y-1">
                {hackathon.location.map((item: string) => (
                  <li>{item}</li>
                ))}
              </ul>
            </div>
          ) : null
        }
      </section>

      <main>
        <TerminalBlock event={event} />
      </main>

      <footer class="mt-6 text-sm text-muted">
        <a href="/" class="text-accent" data-i18n-key="back">← Volver</a>
      </footer>
    </div>
  </div>
</div>
